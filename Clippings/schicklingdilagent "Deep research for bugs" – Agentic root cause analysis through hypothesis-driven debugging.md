---
title: 'schickling/dilagent: "Deep research for bugs" â€“ Agentic root cause analysis through hypothesis-driven debugging'
source: https://github.com/schickling/dilagent
author:
  - "[[schickling]]"
published:
created: 2025-10-01
description: '"Deep research for bugs" â€“ Agentic root cause analysis through hypothesis-driven debugging - schickling/dilagent'
tags:
  - clippings
  - github
  - agent
---
**[dilagent](https://github.com/schickling/dilagent)** Public

"Deep research for bugs" â€“ Agentic root cause analysis through hypothesis-driven debugging

[Open in github.dev](https://github.dev/) [Open in a new github.dev tab](https://github.dev/) [Open in codespace](https://github.com/codespaces/new/schickling/dilagent?resume=1)

<table><thead><tr><th colspan="2"><span>Name</span></th><th colspan="1"><span>Name</span></th><th><p><span>Last commit message</span></p></th><th colspan="1"><p><span>Last commit date</span></p></th></tr></thead><tbody><tr><td colspan="3"><p><span><a href="https://github.com/schickling/dilagent/commit/77d7d90d19d921841a18df350b6430c5bdc9eea3">Merge pull request</a> <a href="https://github.com/schickling/dilagent/pull/3">#3</a> <a href="https://github.com/schickling/dilagent/commit/77d7d90d19d921841a18df350b6430c5bdc9eea3">from schickling/schickling/wip</a></span></p><p><span><a href="https://github.com/schickling/dilagent/commit/77d7d90d19d921841a18df350b6430c5bdc9eea3">77d7d90</a> Â·</span></p><p><a href="https://github.com/schickling/dilagent/commits/main/"><span><span><span>37 Commits</span></span></span></a></p></td></tr><tr><td colspan="2"><p><a href="https://github.com/schickling/dilagent/tree/main/.vscode">.vscode</a></p></td><td colspan="1"><p><a href="https://github.com/schickling/dilagent/tree/main/.vscode">.vscode</a></p></td><td><p><a href="https://github.com/schickling/dilagent/commit/ce073dfe1759904d0c3d3c038d612b4f0f737ffb">Implement comprehensive service architecture for dilagent CLI</a></p></td><td></td></tr><tr><td colspan="2"><p><a href="https://github.com/schickling/dilagent/tree/main/apps/dilagent-cli"><span>apps/</span> <span>dilagent-cli</span></a></p></td><td colspan="1"><p><a href="https://github.com/schickling/dilagent/tree/main/apps/dilagent-cli"><span>apps/</span> <span>dilagent-cli</span></a></p></td><td><p><a href="https://github.com/schickling/dilagent/commit/848148613b7d870b8a4982430f4af861a35b9f93">Refactor CLI commands and README for consistency in hypothesis generaâ€¦</a></p></td><td></td></tr><tr><td colspan="2"><p><a href="https://github.com/schickling/dilagent/tree/main/diagrams">diagrams</a></p></td><td colspan="1"><p><a href="https://github.com/schickling/dilagent/tree/main/diagrams">diagrams</a></p></td><td><p><a href="https://github.com/schickling/dilagent/commit/ce073dfe1759904d0c3d3c038d612b4f0f737ffb">Implement comprehensive service architecture for dilagent CLI</a></p></td><td></td></tr><tr><td colspan="2"><p><a href="https://github.com/schickling/dilagent/tree/main/scripts">scripts</a></p></td><td colspan="1"><p><a href="https://github.com/schickling/dilagent/tree/main/scripts">scripts</a></p></td><td><p><a href="https://github.com/schickling/dilagent/commit/7ab4b15658d191337447ce6d9cf6158f8c625050">Rename project from deebug to dilagent</a></p></td><td></td></tr><tr><td colspan="2"><p><a href="https://github.com/schickling/dilagent/tree/main/specs">specs</a></p></td><td colspan="1"><p><a href="https://github.com/schickling/dilagent/tree/main/specs">specs</a></p></td><td><p><a href="https://github.com/schickling/dilagent/commit/ba34f7ed8913f593b3dd7f2cfb952563cfc486dc">Refactor README and CLI commands for improved clarity and consistency</a></p></td><td></td></tr><tr><td colspan="2"><p><a href="https://github.com/schickling/dilagent/tree/main/test-context-dirs">test-context-dirs</a></p></td><td colspan="1"><p><a href="https://github.com/schickling/dilagent/tree/main/test-context-dirs">test-context-dirs</a></p></td><td><p><a href="https://github.com/schickling/dilagent/commit/a5585d6394baa7459e7dd518b7a0e508afb0a666">Enhance README and update CLI for improved user guidance and functionâ€¦</a></p></td><td></td></tr><tr><td colspan="2"><p><a href="https://github.com/schickling/dilagent/blob/main/.envrc">.envrc</a></p></td><td colspan="1"><p><a href="https://github.com/schickling/dilagent/blob/main/.envrc">.envrc</a></p></td><td><p><a href="https://github.com/schickling/dilagent/commit/7ab4b15658d191337447ce6d9cf6158f8c625050">Rename project from deebug to dilagent</a></p></td><td></td></tr><tr><td colspan="2"><p><a href="https://github.com/schickling/dilagent/blob/main/.gitignore">.gitignore</a></p></td><td colspan="1"><p><a href="https://github.com/schickling/dilagent/blob/main/.gitignore">.gitignore</a></p></td><td><p><a href="https://github.com/schickling/dilagent/commit/0af57fb2de1721050700d60c27817de4f14d2cf3">Initialize project structure with essential configuration files, inclâ€¦</a></p></td><td></td></tr><tr><td colspan="2"><p><a href="https://github.com/schickling/dilagent/blob/main/NOTES.md">NOTES.md</a></p></td><td colspan="1"><p><a href="https://github.com/schickling/dilagent/blob/main/NOTES.md">NOTES.md</a></p></td><td><p><a href="https://github.com/schickling/dilagent/commit/63c0864947e615c9bdad5429484ec5f81ae02d7f">Refactor dilagent CLI to standardize terminology and enhance logging â€¦</a></p></td><td></td></tr><tr><td colspan="2"><p><a href="https://github.com/schickling/dilagent/blob/main/README.md">README.md</a></p></td><td colspan="1"><p><a href="https://github.com/schickling/dilagent/blob/main/README.md">README.md</a></p></td><td><p><a href="https://github.com/schickling/dilagent/commit/848148613b7d870b8a4982430f4af861a35b9f93">Refactor CLI commands and README for consistency in hypothesis generaâ€¦</a></p></td><td></td></tr><tr><td colspan="3"></td></tr></tbody></table>

[![](https://camo.githubusercontent.com/5d6a5c7d1a9a07370acd0fb31c6719b9da200477003fc3826ce626ab439ed420/68747470733a2f2f6769746275636b65742e73636869636b6c696e672e6465762f6170692f6765742f33323333303236333236316438343636626338313436626164633964616262636462663334323561303436343836303937663632663437633130623963663936)](https://camo.githubusercontent.com/5d6a5c7d1a9a07370acd0fb31c6719b9da200477003fc3826ce626ab439ed420/68747470733a2f2f6769746275636b65742e73636869636b6c696e672e6465762f6170692f6765742f33323333303236333236316438343636626338313436626164633964616262636462663334323561303436343836303937663632663437633130623963663936)

## dilagent ðŸ”

**Agentic root cause analysis through hypothesis-driven debugging**

dilagent automates the tedious process of reproducing, diagnosing, and fixing bugs through systematic hypothesis testing and experimentation. It combines LLM agents with structured scientific methodology to identify root causes and validate fixes.

**Ideal for:**

- Complex, hard-to-reproduce bugs (race conditions, timing issues)
- Performance regressions without obvious cause
- Issues that occur only in specific environments
- Bugs with multiple potential root causes
- Intermittent or flaky test failures

**Not suitable for:**

- Simple syntax errors or compilation issues
- Obvious logic errors that are easily spotted
- Issues with clear error messages pointing to the problem

dilagent follows a structured, multi-stage approach to debugging:

First, dilagent attempts to reproduce the issue:

- Creates minimal reproducible test cases (`repro.ts`)
- Measures timing characteristics (performance, timeouts, race conditions)
- Documents setup requirements
- Asks clarifying questions when needed

Based on successful reproduction, dilagent generates targeted hypotheses:

- Analyzes reproduction data and codebase context
- Creates multiple hypotheses (H001, H002, H003...)
- Tailors hypotheses to the type of issue (performance, concurrency, logic)
- Outputs structured `hypotheses.json` for tracking

Each hypothesis is tested in parallel:

- Independent testing in isolated worktrees
- Each hypothesis can result in:
	- âœ… **Proven**: Root cause identified
	- âŒ **Disproven**: Not the issue, move on
	- â“ **Inconclusive**: Requires additional data
- Counter-experiments validate findings

For complex issues requiring human insight:

- REPL-based interactive debugging session
- Agent-assisted exploration with full context
- Direct manipulation and testing

The process continues iteratively until the root cause is found and validated.

## System Architecture

[![System Overview](https://github.com/schickling/dilagent/raw/main/diagrams/manager-flow.svg)](https://github.com/schickling/dilagent/blob/main/diagrams/manager-flow.svg)

[![Hypothesis Loop](https://github.com/schickling/dilagent/raw/main/diagrams/hypothesis-loop.svg)](https://github.com/schickling/dilagent/blob/main/diagrams/hypothesis-loop.svg)

## Key Features

- **Automated Reproduction**: Generates minimal test cases from bug reports
- **Parallel Hypothesis Testing**: Tests multiple theories simultaneously in isolated environments
- **Counter-Experiment Validation**: Prevents false positives through negative testing
- **Interactive Fallback**: REPL mode for complex cases requiring human expertise
- **Evidence-Based**: Every conclusion backed by reproducible experiments
- **MCP Integration**: Leverages Model Context Protocol for tool orchestration
```
dilagent manager setup --working-directory ./debug-session --context-directory ./my-project
```
- Creates `.dilagent/` directory structure
- Generates `context.md` with codebase information and issue description
```
dilagent manager repro --working-directory ./debug-session --llm claude
```
- Creates `reproduction.md` with steps to reproduce the issue
- Generates diagnostic information and error details
```
dilagent manager generate-hypotheses --working-directory ./debug-session --hypothesis-count 3 --llm claude
```
- Creates numbered hypothesis directories: `H001-config-issue/`, `H002-race-condition/`, etc.
- Each contains:
	- `hypothesis.md` - The specific theory about the bug
	- `instructions.md` - Steps to test the hypothesis
```
dilagent manager run-hypotheses --working-directory ./debug-session --llm claude
```
- Creates git worktrees for parallel testing (e.g., `worktree-H001-config-issue/`)
- AI agents test each hypothesis independently
- Updates `report.md` in each hypothesis directory with findings
- Logs stored in `.dilagent/H{NNN}-{slug}/hypothesis.log`

[![](https://camo.githubusercontent.com/b1121d26a2b9202df6993e49b661469833af80d12f5a862bd3017ebea9ba4091/68747470733a2f2f73686172652e636c65616e73686f742e636f6d2f4b68723476576c4c2b)](https://camo.githubusercontent.com/b1121d26a2b9202df6993e49b661469833af80d12f5a862bd3017ebea9ba4091/68747470733a2f2f73686172652e636c65616e73686f742e636f6d2f4b68723476576c4c2b)

**Example report.md output** (click to expand)
```
# Hypothesis H003: Race Condition in Connection Pool

## Status: âœ… PROVEN

## Initial Analysis
The intermittent timeout errors in production suggested a potential race condition
in the database connection pool management. The error pattern showed:
- Errors occur only under high concurrent load (>100 req/s)  
- Error rate increases exponentially with load
- Database logs show connection pool exhaustion messages
- Issue started appearing after the connection pooling refactor in commit abc123

## Investigation Steps

### Step 1: Reproduce the Issue
Created load test script that successfully reproduced the issue:
\`\`\`bash
# Load test that triggers the race condition
ab -n 10000 -c 50 http://localhost:3000/api/users/search
# Result: 3.2% failure rate with "connection pool timeout" errors
```

Identified suspicious code in `src/db/pool.ts:42-58`:

```
// PROBLEMATIC: Race condition between check and increment
if (this.activeConnections < this.maxConnections) {
  // Gap here - another request could increment activeConnections
  this.activeConnections++;
  return this.createConnection();
}
```

The race condition occurs when multiple requests simultaneously:

1. Check `activeConnections < maxConnections` (both see same value)
2. Both increment `activeConnections`
3. Both attempt to create connections
4. Total connections exceed `maxConnections`
5. Database rejects excess connections
6. Pool state becomes inconsistent

## Fix Applied

Implemented atomic operation using mutex lock:

```
// FIXED: Atomic check-and-increment
async acquireConnection(): Promise<Connection> {
  return this.mutex.acquire(async () => {
    if (this.activeConnections >= this.maxConnections) {
      throw new PoolExhaustedError();
    }
    this.activeConnections++;
    return this.createConnection();
  });
}
```

## Validation Results

### Load Testing

- âœ… 10,000 requests at 50 concurrent: 0% failure rate
- âœ… 50,000 requests at 200 concurrent: 0% failure rate
- âœ… Connection count never exceeds maxConnections under load

### Code Review

- âœ… All database operations now use atomic operations
- âœ… Added connection pool metrics and monitoring
- âœ… Updated connection pool tests to include concurrency scenarios

### Counter-Experiments

- âœ… Reverting to old code: Issue reproduces immediately
- âœ… Artificially increasing load beyond capacity: Proper error handling
- âœ… Simulating connection failures: Pool recovers correctly

## Performance Impact

- No measurable latency increase (<1ms)
- Memory usage unchanged
- CPU overhead negligible

## Additional Observations

- This pattern exists in 3 other services using the same pooling library
- Similar race conditions found in Redis connection pool
- Recommended: Audit all resource pooling implementations company-wide

## Files Modified

- `src/db/pool.ts` - Fixed race condition
- `tests/db/pool.test.ts` - Added concurrency tests
- `package.json` - Added async-mutex dependency

```
</details>

### Stage 4: Summary
\`\`\`bash
dilagent manager summary --working-directory ./debug-session
```

- Aggregates all hypothesis reports
- Generates final summary with likely root causes and fixes

## Quick Start

## Troubleshooting

**Issue: Reproduction fails**

- Ensure the bug description is clear and specific
- Check that all required dependencies are installed
- Verify the issue occurs in the provided codebase

**Issue: All hypotheses are inconclusive**

- Try increasing `--hypothesis-count` to generate more hypotheses
- Add more context to `context.md` about recent changes
- Use `--repl` mode for manual exploration

**Issue: Worktree creation fails**

- Ensure you're in a git repository
- Check that git worktree is supported (Git 2.5+)
- Verify sufficient disk space for multiple worktrees

## Configuration

**Environment Variables:**

- `DILAGENT_CLI_PATH` - Automatically set to CLI location for MCP proxy

**LLM Tools:**

- Requires either `claude` or `codex` command in your PATH
- Claude recommended for best results
- Configure your API keys according to your LLM tool's documentation

**Working Directory Best Practices:**

- Use a dedicated directory (e.g., `./debug-sessions/issue-123/`)
- Keep separate from your main codebase
- Clean up old sessions periodically to save disk space

## Requirements

- Bun 1.2+
- Git (for worktree isolation)
- Local LLM tool (`claude` or `codex` command available in PATH)

## Releases

No releases published

## Packages

No packages published  

## Languages

- [TypeScript 95.6%](https://github.com/schickling/dilagent/search?l=typescript)
- [Mermaid 3.2%](https://github.com/schickling/dilagent/search?l=mermaid)
- Other 1.2%