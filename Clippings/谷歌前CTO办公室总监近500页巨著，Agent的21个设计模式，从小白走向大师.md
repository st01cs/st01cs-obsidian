---
title: 谷歌前CTO办公室总监近500页巨著，Agent的21个设计模式，从小白走向大师
source: https://mp.weixin.qq.com/s/XTklOXPV1sjcijwajxD_7A
author:
  - "[[AI修猫Prompt]]"
published:
created: 2025-09-30
description: 面向业务负责人：小成本试错的大规模复制方法。
tags:
  - clippings
  - agent
---
原创 AI修猫Prompt *2025年09月18日 23:13*

从LLM到Agentic的产业拐点上，最难的并不是让模型会写一段代码或生成一份报告，而是把 **能力** 稳定地固化进 **工程体系** ：如何拆解任务、如何在多人，多Agent协作下保证可追溯、如何做异常恢复与安全护栏、以及如何在成本与效果间做资源感知的最优分配。最近，谷歌前CTO办公室的资深工程负责人Antonio Gulli发布了一本近500页的系统化手册，给出了一个可落地的答案，以 **设计模式** 而非“单点技巧”来组织Agentic AI的全部关键能力与系统骨架。

这本书之所以重要，不在于它又提出了一个“新框架”，而在于它把过去散落在学术与业界的做法（如路由、反思、自洽、工具调用、RAG、HITL、评估监控与护栏等） **抽象成可复用的模式单元** ，并明确了“什么时候用、如何串接、失败时如何回退”的工程路径。换句话说，它讨论的是 **如何把‘能做出来’变成‘做得稳、管得住、可度量’** 。

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/Iurk1iaf4xdHts9Gl6icSbPAE53Kl30Et80v4Db8m6FS6svDuS6C1zxEZcMkh157aHeNelS2ibxy7cYW2U5bprCHw/640?wx_fmt=jpeg&watermark=1&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=0)

**本文价值主张** ：我不会复述目录，而是围绕“为什么要这样分层、每一层解决什么工程矛盾、实际落地的代价与收益比”来解构这 21 个模式；每个模式我都会给出 **决策边界** （适用/不适用场景）、 **失败常见反模式** （踩坑点）、以及 **可操作的工作流要点** （输入/验证/回退/追溯）。全文按“ **核心能力，协作与规划，系统韧性，优化与度量，战略探索** ”五层展开，帮助您把“点状技巧”折叠进一套可迭代的工程化蓝图。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Iurk1iaf4xdHts9Gl6icSbPAE53Kl30Et8fE6u6tGnt8yZtwq3eCOIIav6QseicEDDJtBr30XoKLibpU19l8NBO5xA/640?wx_fmt=png&from=appmsg&watermark=1&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=1)

## 核心模式：构建智能体的基石

任何宏伟的建筑都始于坚实的地基。它们是智能体执行任务、与世界交互、并进行基本自我完善所需的最基础、最本质的能力单元。掌握这些模式，就如同掌握了编程语言中的变量、循环和函数，是后续一切复杂架构的起点。它们定义了智能体如何将宏大任务分解为有序步骤，如何在众多选项中做出正确决策，如何获取和利用外部知识，以及如何进行最基础的自我批判与修正。让我们从构建智能体思维逻辑的起点开始。

### 模式一：提示链（Prompt Chaining） 任务拆解的艺术

**核心思想** ：将一个庞大、复杂的任务分解成一系列更小、可管理的子步骤，然后像流水线一样按顺序执行。其精髓在于，链条中的每一步不仅完成自己的任务，还会对上一步的输出进行 **验证** ，确保质量和准确性，从而在错误发生前及时捕获并修正。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Iurk1iaf4xdHts9Gl6icSbPAE53Kl30Et8OHbVpRds9KEE9VV9YgT92qOd5ozprRR8LYn2m1vsOIDvI0MKrVibDhQ/640?wx_fmt=png&from=appmsg&watermark=1&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=2)

**工作流详解** ： 想象一条精密的汽车生产线。用户输入（ `User Input` ）如同一个“制造一辆汽车”的宏大指令。系统首先将这个指令分解为多个子任务（ `Subtasks` ），例如“安装底盘”、“焊接车身”、“喷漆”、“组装引擎”等，并明确每个任务之间的“数据契约”（ `Data Contracts` ），即交接标准。

1. **执行与验证** ：任务一（“安装底盘”）开始执行。完成后，其输出结果不会直接传递给任务二。相反，任务二（“焊接车身”）的第一个动作是 **验证** 任务一的输出是否合格。这个验证环节就像质检员，确保底盘安装无误。
2. **失败与重试** ：如果验证失败，系统会触发重试机制（ `Retry Loop` ），直到任务一的输出通过验证。这个闭环是保证最终产品质量的关键。
3. **顺序传递** ：验证通过后，数据才被传递到下一个环节。这个过程在链条中不断重复，直至所有任务执行完毕。
4. **结果整合与日志记录** ：最后，系统将所有步骤的结果整合（ `Merge Results` ），组装成最终的输出。至关重要的是，整个链条中的每一步操作、每一次验证、每一次失败与重试，都会被详细记录下来（ `Log Artifacts` ）。这就像一份详尽的生产履历，当最终输出出现问题时，我们可以轻松回溯，精准定位问题发生的环节。

相关的文章，感兴趣您可以看一下

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/Iurk1iaf4xdFyIsvq4ooNFXFtsp5daA0NY5n1MJxFfDs1HtxDbK8mx1SkI6mOUKD55q86mSjcbXsJn63HGmG8iaQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=3)

[还在用陈旧的CoT？是时候升级你的技术了，你应该掌握的XML高级提示链Prompt Chain](https://mp.weixin.qq.com/s?__biz=Mzg4MzYxODkzMg==&mid=2247488149&idx=1&sn=a875f5a6dab9899ee012f5f04cb6beb1&scene=21#wechat_redirect)

**应用场景** ：

- **复杂的多步骤流程** ：如报告生成，需要搜集数据、分析数据、生成图表、撰写摘要等多个步骤。
- **数据转换与清洗（ETL）** ：处理非结构化或“脏”数据时，可以设置多个链条步骤，分别负责列名标准化、数据类型清洗、格式统一等。
- **内容创作** ：撰写一篇深度文章，可以分为大纲生成、初稿撰写、事实核查、风格润色等多个链环。

**优点** ：

- **模块化（Modular）** ：链条中的每个环节相对独立，可以轻松替换或调整，而不影响整个流程。
- **错误隔离** ：分步验证机制能有效防止错误的传播和累积。
- **可追溯性** ：详尽的日志使得调试和优化变得异常清晰。

**缺点** ：

- **上下文爆炸（Context Explosion）** ：如果每一步都携带之前所有步骤的上下文，随着链条变长，传递的数据（如JSON载荷）会急剧膨胀，导致Token成本飙升。
- **错误传播风险** ：如果提示词设计不佳，可能导致错误的输出通过了验证，那么这个初始错误将被后续所有环节继承和放大。
- **延迟较高** ：多个顺序执行的LLM调用点（推理点）会显著增加总处理时间。

### 模式二：路由（Routing） 智能分诊台

**核心思想** ：像一位经验丰富的总机接线员或医院的分诊护士，路由模式首先分析传入请求的 **意图（Intent）和上下文（Context）** ，然后将其精确地导向最适合处理该请求的 **专家智能体（Specialist Agent）** 。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Iurk1iaf4xdHts9Gl6icSbPAE53Kl30Et8pyfhPOSQuCbcusogSge7oaUv1ESfhppSDZJFvSYGu2AONLXg56l1kQ/640?wx_fmt=png&from=appmsg&watermark=1&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=4)

**工作流详解** ： 当一个用户请求（ `User Request` ）进入系统，路由AI会立即启动分析。

1. **意图分析** ：AI会解析请求的本质。例如，用户问“我的订单为什么还没到？”AI会识别出这是“物流查询”的意图，应交由“技术支持智能体”处理。如果用户问“你们最新的产品有什么优惠？”，则应路由到“销售智能体”。
2. **决策与置信度** ：基于意图分析，系统做出路由决策。为了提高可靠性，可以引入 **置信度评分（Confidence Score）** 。例如，LLM可以评估其决策的把握程度，给出一个1到10的分数。
3. **澄清循环** ：如果置信度低于预设阈值（例如低于7分），系统不会贸然行动，而是会主动向用户 **请求澄清（Request Clarification）** ，提出更具体的问题，直到收集到足够信息，置信度达标为止。这是避免错误路由的关键。
4. **分发与响应** ：一旦确定了目标智能体，请求就被分发过去。专家智能体处理完毕后，返回结果，系统最终将响应交付给用户。

**应用场景** ：

- **客户服务中心** ：自动将用户问题分发给技术支持、账单查询、销售咨询等不同部门的AI或人工坐席。
- **企业级自动化** ：根据员工请求（如“申请休假”、“报销差旅费”），调用不同的人力资源或财务系统API。
- **医疗分诊** ：一个前端语音智能体可以根据患者描述的症状，将其引导至相应的科室或提供紧急处理建议。

**优点** ：

- **专业化（Specialization）** ：每个智能体只专注于自己擅长的领域，提高了处理质量和效率。
- **可扩展性（Scalability）** ：可以轻松增加新的专家智能体来处理新的业务领域。
- **效率提升** ：避免了让一个通用模型处理所有类型问题的低效。

**缺点** ：

- **路由错误** ：核心风险在于路由本身的准确性。错误的路由会导致整个处理流程的失败。
- **易受边缘案例影响（Prone to Edge Cases）** ：对于模糊或前所未见的请求，路由系统可能难以决策。此时，引入“人类介入”或一个“管理者智能体”进行仲裁是必要的。

### 模式三：并行化（Parallelization） 分而治之，同时出击

**核心思想** ：将一个大型任务分解成多个 **相互独立的子任务** ，然后派遣多个“工作智能体”（Worker Agents）同时处理这些子任务，最后将所有结果汇总，形成最终输出。这就像组织10个人同时阅读一本书的不同章节，最后再将每个人的章节摘要合并成全书摘要。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Iurk1iaf4xdHts9Gl6icSbPAE53Kl30Et8oPC39gMH8tibdw0bmmc1hX2clLia9xUW632PMGERLY527H0vNn84lNzg/640?wx_fmt=png&from=appmsg&watermark=1&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=5)

**工作流详解** ： 面对一个宏大的输入（ `Large Input` ），例如“将我们SaaS平台的客户流失率降低20%”。

1. **任务分解与资源评估** ：首先，一个主智能体（Manager Agent）会分析这个目标，并将其分解为多个可并行的子任务，如“对流失客户进行问卷调查”、“分析产品使用数据寻找痛点”、“研究竞争对手的客户保留策略”等。同时，它会评估可用的计算资源。
2. **生成工作智能体** ：根据子任务的数量和可用资源，主智能体 生成（Spawn） 多个并行的工作智能体，并将每个子任务分配给一个工作智能体。
3. **独立执行与重试** ：每个工作智能体独立地、并行地执行其被分配的任务。它们内部同样拥有重试循环，以确保任务成功完成。
4. **结果收集与归一化** ：当所有工作智能体完成任务后，主智能体收集它们各自的成果。关键的一步是 **归一化（Normalize）** ，即将不同格式、不同维度的结果（就像苹果、橙子和菠萝）统一成标准格式（全部变成苹果）。
5. **合并与总结** ：归一化后的结果被合并（ `Merge` ）成一个单一、简化的输出，并生成最终的摘要报告。一个高级实践是 **标注来源（Provenance）** ，即在最终报告中注明每个部分是由哪个工作智能体贡献的，便于追溯和调试。

**应用场景** ：

- **大规模数据处理** ：同时对数千个文档进行摘要、分类或信息提取。
- **网络爬虫** ：派遣多个爬虫智能体同时抓取不同网站或网站的不同页面。
- **研究自动化** ：一个研究任务可以分解为文献检索、数据收集、实验模拟等多个并行执行的部分。
- **软件测试** ：同时在多个虚拟环境中运行不同的测试用例。

**优点** ：

- **速度极快** ：并行处理大大缩短了完成大型任务所需的总时间。
- **高可扩展性** ：理论上，只要资源允许，可以无限增加工作智能体来应对更大的任务。

**缺点** ：

- **合并复杂性** ：将多个独立工作流的输出整合成一个连贯、有意义的最终结果，是技术上的一大挑战。
- **资源协调** ：管理和调度大量并行智能体需要复杂的底层架构。
- **增加了系统复杂性** ：就像公司扩张需要引入HR和管理层一样，并行智能体系统也需要引入更复杂的协调和管理机制。

### 模式四：反思（Reflection） 批判性思维的循环

**核心思想** ：引入一个“批判者”（Critic）角色，对生成的内容进行迭代式优化。流程是：生成初稿 -> 批判者根据预设标准进行评估 -> 生成器根据反馈进行修改 -> 循环此过程，直到满足质量要求。这就像写一篇论文，交给导师审阅，然后根据导师的意见反复修改，直到获得“A+”评级。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Iurk1iaf4xdHts9Gl6icSbPAE53Kl30Et8bAJClniaEaJjvy8PRUqNndQvQeIxXwqXLs2iaK81dicOkyEqShgHYXmVA/640?wx_fmt=png&from=appmsg&watermark=1&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=6)

**工作流详解** ：

1. **生成初稿** ：接收到初始请求后，一个“生成者智能体”会产出第一版输出（ `First Draft` ）。
2. **批判性评估** ：这份初稿被提交给一个“批判者智能体”（ `Critic Agent` ）。这个批判者手持一份 **质量标准清单（Quality Rubrics）** ，可能包括：
- **单元测试（Unit Tests）** ：检查输出是否满足预定义的逻辑和格式要求。
	- **语法与逻辑检查（Grammar & Logic Check）** ：评估内容的流畅性和合理性。
	- **事实核查** ：验证内容中的信息是否准确。
4. **决策分支** ：
- **如果满足标准** ：输出被接受，系统记录下成功的模式，并可能用此案例来更新未来的提示或规则。
	- **如果不满足标准** ：批判者会生成一份 **结构化的反馈（Structured Feedback）** ，清晰地指出问题所在以及改进建议。
6. **迭代修正** ：这份结构化反馈被送回给生成者智能体，后者基于反馈生成新一版的输出。这个“生成-批判-修正”的循环会持续进行。
7. **设置上限** ：为了防止无限循环和成本失控，必须设置一个 **最大重试次数（Max Count）** 。如果达到上限仍不满足标准，流程将终止并标记为失败。

关于“反思”，感兴趣您可以看下

[![图片](https://mmbiz.qpic.cn/mmbiz_jpg/Iurk1iaf4xdG1MCP3uJTjmKb3LNaAlPBAuMToLicZUfkyFhmR95P2jboKGurBLTNHmSDGib3ibYKufbeDnaCiaGU6XA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=7)](https://mp.weixin.qq.com/s?__biz=Mzg4MzYxODkzMg==&mid=2247495495&idx=1&sn=f64c2a9c3f748251faaf50d8be0c81f0&scene=21#wechat_redirect)

[用REAP让o1更强！反思、显式问题解构和高级Prompt](https://mp.weixin.qq.com/s?__biz=Mzg4MzYxODkzMg==&mid=2247495495&idx=1&sn=f64c2a9c3f748251faaf50d8be0c81f0&scene=21#wechat_redirect)

**应用场景** ：

- **高质量内容生成** ：撰写法律文件、学术论文、营销文案等对准确性和质量要求极高的内容。
- **代码生成** ：生成代码后，由一个批判者智能体运行测试用例、检查代码风格和潜在bug。
- **创意性任务** ：在需要保持创造性（高“温度”设置）的同时，确保最终输出符合特定规范和要求。

**优点** ：

- **质量卓越** ：专注于迭代优化，能够产出远超单次生成质量的成果。
- **鲁棒性强** ：通过多轮校验，有效减少了事实错误和逻辑谬误。

**缺点** ：

- **成本高昂** ：多次LLM调用意味着数倍的API成本和时间延迟。
- **API节流风险（API Throttling）** ：在高并发场景下（如为成千上万个产品生成描述），频繁的API请求可能触发服务商的速率限制。
- **依赖批判者的质量** ：如果批判者的评估标准本身就有问题，那么整个优化过程可能会误入歧途。

### 模式五：工具使用（Tool Use） 智能体的“双手”

**核心思想** ：当智能体需要与外部世界交互（获取信息或执行操作）时，它能够自主地 **发现** 可用工具、 **检查** 使用权限、并用正确的参数 **调用** 合适的工具。这就像一位厨师，需要特定食材时，他会查看储藏室里有什么（发现），确认食材是否可用（检查权限），然后取出并精确地用于烹饪（调用）。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Iurk1iaf4xdHts9Gl6icSbPAE53Kl30Et8k2fPb1ALYuglGL363cMT1nvtISRGFuxRS7THYscUHVkTjveicJiaESBQ/640?wx_fmt=png&from=appmsg&watermark=1&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=8)

**工作流详解** ：

1. **需求分析与工具发现** ：接到用户请求后，智能体分析出要完成任务需要外部能力。它会扫描其“工具箱”，发现可用的工具，如网络搜索API、数据库查询工具、计算器函数、文件系统访问权限等。
2. **工具选择与安全检查** ：智能体将任务需求与工具的功能进行匹配，选择最合适的工具。在调用前，会进行 **安全检查（Safety Check）** ，确保自己有权限使用该工具，并且此次调用不会带来安全风险。
3. **准备与执行调用** ：智能体准备好调用工具所需的参数，然后执行调用。
4. **结果解析与回退机制** ：工具返回结果后，智能体需要解析这个结果。这个过程可能需要另一个LLM调用来将非结构化的API响应“归一化”为智能体能理解的格式。如果工具调用失败，系统应有 **回退方法（Fallback Method）** ，例如尝试另一个工具或通知用户。
5. **失败处理** ：如果因权限不足或选择了错误的工具而失败，系统应记录失败原因，并可能在未来调整其工具选择逻辑。

关于Tool use Function calling，我介绍过OpenAI的提示词

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/Iurk1iaf4xdGoPcOpdxsPe3qyhVePZiaZRib03pA4yWEwdn6YHRyr5LicTsoFeWyYu1iafoUCiccmHBkXb6AbNEUPTUg/640?wx_fmt=jpeg&watermark=1&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=9)

[函数调用提示词咋写，看下OpenAI发布的Function Calling指南（万字含示例）｜最新](https://mp.weixin.qq.com/s?__biz=Mzg4MzYxODkzMg==&mid=2247500220&idx=1&sn=fca2c3b54063a29e291191a9880bfbcd&scene=21#wechat_redirect)

**应用场景** ：几乎所有需要与现实世界数据或系统交互的场景。

- **研究助理** ：使用网络搜索工具查找最新论文，使用数据库工具查询实验数据。
- **数据分析** ：调用Python代码执行器或数据可视化库来处理和展示数据。
- **个人助理** ：调用日历API安排会议，调用邮件API发送邮件。

**优点** ：

- **能力扩展** ：极大地扩展了LLM的能力边界，使其不再局限于其训练数据。
- **提高准确性** ：能够获取实时、准确的外部信息，减少幻觉。

**缺点** ：

- **工具调用失误** ：如果第一步的工具选择或参数准备就错了（就像数学计算第一步除法就错了），后续所有步骤都将是徒劳。
- **安全性** ：给予智能体工具使用权限，尤其是文件系统或数据库写入权限，带来了巨大的安全挑战。
- **复杂性** ：管理工具的发现、授权、调用和错误处理，需要复杂的工程实现。

## 高级模式：从个体智能到群体智慧的飞跃

当掌握了单个智能体的核心能力后，真正的挑战在于如何解决规模更大、复杂度更高的问题。这需要我们从“个体”的思维模式，跃迁到“团队协作”的架构，高级模式正是实现这一飞跃的蓝图。它们引入了并行处理、战略规划、以及多智能体间协同工作的复杂机制，让智能体不再是孤立的执行者，而是能够像一个分工明确、配合默契的高效团队一样运作。同时，我们也将探索更深层次的“思考”方式，让智能体面对难题时，能迸发出超越线性逻辑的智慧火花。我们将首先深入“并行化”模式，看看当一个任务可以被“分而治之”时，效率将如何实现指数级提升。

### 模式六：规划（Planning） 运筹帷幄，决胜千里

**核心思想** ：在执行一个宏大目标前，智能体首先创建一个详尽的、分步走的行动计划。这不仅仅是任务拆解，更包含了对 里程碑（Milestones）、依赖关系（Dependencies）和约束条件（Constraints）的系统性思考 。这好比规划一场长途自驾游，不仅要设定每日的目的地，还要监控交通状况、预估油耗、并随时准备调整路线。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Iurk1iaf4xdHts9Gl6icSbPAE53Kl30Et8p2micWh2dsg5MIdSbAg0FoLnI0gdAqGGhicKe7btlWgRVhA7nl0IbH2w/640?wx_fmt=png&from=appmsg&watermark=1&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=10)

**工作流详解** ：

1. **目标定义与里程碑划分** ：输入一个明确的目标（ `Goal Input` ），规划智能体将其分解为几个关键的里程碑。
2. **构建依赖图（Dependency Graph）** ：智能体分析任务间的逻辑关系，明确哪些任务必须在其他任务之前完成，形成一个任务依赖网络。
3. **约束检查（Check Constraints）** ：系统会全面评估执行计划的可行性，检查各种约束，如数据是否可用、是否有操作权限、预算是否充足、是否存在截止日期等。
4. **生成分步计划** ：综合以上信息，生成一个详细的、按部就班的执行计划，并为每一步分配合适的智能体和工具。
5. **执行与进度跟踪** ：按计划顺序执行每一步，并持续跟踪进度。如果一切顺利，直到目标达成。
6. **动态调整** ：如果在执行过程中遇到意外情况（如某个API不可用），系统会分析原因，评估是否有新信息出现。如果这是一个需要人工干预的“边缘案例”，则触发“人类介入”模式。否则，系统会尝试调整计划，绕过障碍，最终完成目标。

**应用场景** ：

- **项目管理** ：自动为一个软件开发项目生成任务列表、分配资源并跟踪进度。
- **复杂研究项目** ：规划一个科学研究的完整流程，从文献综述到实验设计，再到数据分析和论文撰写。
- **软件开发** ：在编写复杂代码前，先进行周密的规划，明确模块划分、接口设计和实现步骤，可以显著提高代码质量和开发效率。

**优点** ：

- **战略性执行** ：深思熟虑的规划使得执行过程更具条理和效率。
- **高适应性** ：预先考虑了依赖和约束，使系统在面对变化时能更灵活地调整。

**缺点** ：

- **前期投入大** ：规划阶段本身就需要大量的计算资源和时间。
- **协调复杂** ：管理多个智能体、工具和它们之间的依赖关系，是一项复杂的工程挑战。

### 模式七：多智能体协作（Multi-Agent Collaboration） 组建梦之队

**核心思想** ：让多个拥有不同专业技能的智能体在一个 **中央协调者（Central Manager） **的指挥下协同工作，共同完成一个复杂的任务。这些智能体通常共享一个** 共同的记忆空间（Shared Memory）** ，以确保信息同步。这就像一个电影摄制组，导演（协调者）统筹全局，而摄影、灯光、音效等各个专家（专业智能体）则各司其职，所有人参照同一份剧本和时间线工作。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Iurk1iaf4xdHts9Gl6icSbPAE53Kl30Et8AibibnO7jxicq66NBS56jiaYQzImZQRdoXHDOWt6Ve28d9lOt6ADhV6YeA/640?wx_fmt=png&from=appmsg&watermark=1&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=11)

**工作流详解** ：

1. **角色定义** ：根据复杂任务的需求，系统定义出多个专业角色，如“研究员”、“分析师”、“作家”、“代码审查员”等，并为每个角色实例化一个智能体。
2. **建立共享资源** ：搭建一个所有智能体都能访问的共享基础设施，包括共享记忆库、文件存储区、版本控制系统等。
3. **协调与任务分配** ：协调者（Orchestrator）是整个系统的“大脑”。它接收总任务，将其分解成子任务，然后像在Jira或Asana看板上分配工单一样，将每个子任务指派给最合适的专业智能体。
4. **契约式执行** ：每个智能体完成自己的任务后，其输出必须满足预先定义的“验收标准”（Acceptance Criteria），就像完成一张工单需要满足所有要求。只有通过验收，流程才能进入下一阶段。
5. **整合与最终验收** ：所有子任务完成后，协调者会进行一次总体验收测试。如果通过，任务完成。如果失败，系统会分析协调失败的原因，并可能回滚或重新分配任务。同样，这里也需要设置最大重试次数以防死循环。

对于 Multi-Agent的全局提示词优化，修猫之前介绍过一篇Google的论文，感兴趣您可以看一下

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/Iurk1iaf4xdEX6rfXRc7JKu9HibBbXyxStvadWIkyUNd5Gc17oSpOpjsibx8MPsnKVPja9PVtuuc5VVfvXP45jChQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=12)

[DeepSeek更强了，Agent的Prompt优化该咋整？谷歌、剑桥的MASS：用更好的提示和拓扑优化Agent](https://mp.weixin.qq.com/s?__biz=Mzg4MzYxODkzMg==&mid=2247499000&idx=1&sn=b0cf672084eed99f51f068201e0b51af&scene=21#wechat_redirect)

**应用场景** ：

- **软件开发** ：一个智能体负责编写代码，另一个负责测试，第三个负责编写文档，由一个项目经理智能体协调。
- **金融分析报告** ：一个智能体负责搜集市场数据，一个负责建立财务模型，一个负责生成图表，最后一个负责撰写分析报告。
- **产品开发** ：模拟一个完整的产品团队，进行市场调研、产品设计、原型开发和用户测试。

**优点** ：

- **深度专业化** ：能够处理极其复杂和多面的任务。
- **并行处理能力** ：多个智能体可以同时工作，效率高。

**缺点** ：

- **通信开销** ：智能体之间的协调和信息同步会产生巨大的通信成本和复杂性。
- **记忆一致性** ：维护共享记忆的一致性和避免冲突，是分布式系统中的经典难题。
- **系统脆弱性** ：协调者的设计至关重要，一旦协调者出现问题，整个系统可能瘫痪。

### 模式八：记忆管理（Memory Management） 赋予智能体持久的智慧

**核心思想** ：模拟人类大脑的记忆机制，将信息分类为 **短期会话记忆、中期情景记忆和长期知识记忆** ，并根据其新近度（Recency）和相关性（Relevance）进行存储和检索。这使得智能体能够跨越单次会话，保持上下文连贯性，实现真正的个性化交互。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Iurk1iaf4xdHts9Gl6icSbPAE53Kl30Et8SJd8OuxJr1nd4T8Ma8nGKBNGuKJeCfcfwYKeickyrBmYIYXVEiasiclbA/640?wx_fmt=png&from=appmsg&watermark=1&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=13)

**工作流详解** ：

1. **信息捕获与分类** ：当用户与智能体交互时，系统会捕获产生的信息，并由一个“记忆分类器”判断其类型：
- **短期记忆** ：仅在当前会话中有效的信息，存储在上下文窗口中。
	- **情景记忆（Episodic）** ：与特定事件或对话相关的记忆，如“用户上次询问了关于Python的问题”。
	- **长期记忆（Long-term）** ：需要永久存储的核心知识或用户偏好，如“用户的职业是数据科学家”。
3. **存储与索引** ：
- 对于短期记忆，如果上下文窗口已满，系统会对其进行 **压缩（Compress）** 。
	- 对于中长期记忆，信息会被 **索引** 并添加元数据（如时间戳、主题标签），然后存入向量数据库等持久化存储中。
5. **记忆检索** ：当处理新请求时，智能体的“记忆检索模块”会启动：
- 查询记忆库，根据请求的相关性、时间等过滤器，找出最相关的记忆片段。
	- 将检索到的记忆注入到当前的提示中，为LLM提供丰富的上下文。
7. **隐私处理与更新** ：在存储和使用记忆时，系统必须包含隐私保护机制，如对敏感信息进行 **脱敏（Redact）** 。交互结束后，相关的记忆会被更新或固化。

记忆框架，您可以看一下

[![图片](https://mmbiz.qpic.cn/mmbiz_jpg/Iurk1iaf4xdGlmj4svn2IawyKia0x4WBaq3t3RcmNcNBMiaLsRBd9JIGwu8fk7d73t2WpLlsEMLqKOxyL33NTeByA/640?wx_fmt=jpeg&watermark=1&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=14)](https://mp.weixin.qq.com/s?__biz=Mzg4MzYxODkzMg==&mid=2247500503&idx=1&sn=ee310c4fdabd98122fbbf8bc7d1980f4&scene=21#wechat_redirect)

[Agent不长记性咋整？试试G-Memory，可进化的有组织“集体大脑”](https://mp.weixin.qq.com/s?__biz=Mzg4MzYxODkzMg==&mid=2247500503&idx=1&sn=ee310c4fdabd98122fbbf8bc7d1980f4&scene=21#wechat_redirect)

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/Iurk1iaf4xdFZXmG39mAKCTrChCozlccgqwGFszw8CUfV3CJYSRLceNtKNmtMBvNIoGrZj5aPM8onOqXw6ULcnw/640?wx_fmt=jpeg&watermark=1&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=15)

[多Agent集体失忆？试下内在记忆框架，每个Agent都有自己的异构笔记本](https://mp.weixin.qq.com/s?__biz=Mzg4MzYxODkzMg==&mid=2247501715&idx=1&sn=15c042804dea9780dc3096bbc823ee6e&scene=21#wechat_redirect)

**应用场景** ：

- **个性化助理** ：记住用户的习惯、偏好和之前的对话内容，提供高度定制化的服务。
- **教育平台** ：记住学生在某个知识点上的薄弱环节，在后续教学中针对性地加强解释。
- **客户服务** ：客服智能体能够访问客户完整的历史交互记录，提供无缝、连贯的服务体验。

**优点** ：

- **上下文保持** ：实现了跨会话的对话连续性，极大提升了用户体验。
- **深度个性化** ：使智能体能够真正“了解”用户。

**缺点** ：

- **隐私与安全** ：存储用户数据带来了巨大的隐私泄露和安全风险。
- **记忆污染** ：如何筛选有价值的记忆并遗忘无用的信息，避免记忆库变得臃肿和混乱，是一个巨大挑战。
- **成本高** ：持久化存储和高效检索需要额外的基础设施和成本。

### 模式九：学习与适应（Learning & Adaptation） 自我进化的闭环

**核心思想** ：建立一个反馈循环，系统性地收集来自用户修正、评分、任务结果等渠道的反馈信号，经过清洗和验证后，用于自动更新和优化智能体的 **提示、策略或知识库** 。这就像一位厨师根据顾客的口味反馈和试吃结果，不断调整自己的菜单和配方。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Iurk1iaf4xdHts9Gl6icSbPAE53Kl30Et8Q9GwLiaQnK62SegqibyILb7WCQTmo0OhZpiaCYfgHqXItZDv0qOjLdXcw/640?wx_fmt=png&from=appmsg&watermark=1&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=16)

**工作流详解** ：

1. **反馈收集** ：系统通过多种渠道捕获反馈信号，如用户直接纠正错误、给出“赞”或“踩”的评分、自动化评估脚本的运行结果等。
2. **信号处理与去噪** ：收集到的反馈信号首先要经过质量检查。系统需要 **去噪（Denoise）** ，过滤掉恶意的、无效的或无关的反馈（例如，竞争对手的恶意差评）。
3. **决定学习方式** ：系统根据反馈的性质，决定如何“学习”：
- **更新提示（Update Prompts）** ：微调系统提示或示例（Few-shot examples）。
	- **更新策略（Update Policies）** ：调整智能体的行为规则或决策逻辑。
	- **更新知识库** ：向RAG系统的知识库中添加新的信息或修正错误信息。
	- **模型微调（Fine-tuning）** ：在极少数情况下，如果积累了大量高质量的反馈数据，可以用于微调一个基础模型。
5. **A/B测试与性能监控** ：应用更新后，系统会通过A/B测试等方式，监控性能指标，验证这次“学习”是否带来了积极的改进。

**应用场景** ：

- **任何需要持续优化的系统** ：如推荐系统、内容审核机器人、智能客服等。
- **个性化服务** ：根据用户的隐式和显式反馈，动态调整服务策略。

**优点** ：

- **持续改进** ：使系统能够随着时间的推移自我完善，适应用户需求和环境变化。

**缺点** ：

- **学习错误信息** ：最大的风险在于系统“学坏了”，将错误的反馈当作事实来更新自己，导致性能下降甚至产生有害输出。
- **训练成本** ：处理反馈、更新系统，尤其是模型微调，都会产生额外的计算成本。
- **反馈稀疏性** ：高质量的反馈数据往往难以获取。

## 系统模式：铸造生产级应用的健壮骨架

一个聪明的“大脑”若没有强健的“身体”和完善的“免疫系统”，终究无法在复杂的现实世界中稳定运行。系统模式关注的正是这一点：它们不是智能体的“思考”方式，而是支撑其长期、可靠、安全运行的“生命支持系统”。这些模式为智能体提供了持久的记忆、处理意外的韧性、与人类和谐共存的接口，以及确保其行为始终处于可控范围内的安全护栏。它们是将一个聪明的原型，转变为一个值得信赖的生产级应用所不可或缺的工程实践。这一切的起点，是赋予智能体长期记忆的能力。

### 模式十：目标设定与监控（Goal Setting & Monitoring） 智能体的“GPS导航”

**核心思想** ：为智能体定义清晰、可衡量的 **SMART目标** （具体的、可衡量的、可实现的、相关的、有时限的），并设定关键绩效指标（KPIs）。在执行过程中，持续监控这些指标，一旦发现偏离（Drift）目标的迹象，就立即进行分析和 **路线修正（Course-correct）** 。这就像一个GPS导航系统，设定了目的地，实时监控你的位置和速度，一旦你走错路，它会立即重新计算路线。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Iurk1iaf4xdHts9Gl6icSbPAE53Kl30Et8kSEUholPtvzXgyryRb1qiaFeUTQnhdF6oewejgxicc6rneaRYLGCZY7g/640?wx_fmt=png&from=appmsg&watermark=1&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=17)

**工作流详解** ：

1. **定义目标与KPI** ：明确任务的最终目标，并将其量化为具体的KPI，如“在24小时内，将客户满意度评分从4.2提升到4.5”。同时设定预算、时间和资源等约束。
2. **设置质量门（Quality Gates）** ：在任务流程的关键节点设置检查点，确保中间产出符合质量要求。
3. **持续监控** ：任务开始执行后，监控系统持续收集关于KPIs、资源消耗、响应时间等数据。
4. **偏离检测与分析** ：将实时数据与预设目标进行比较。如果发现显著偏离，系统会立即暂停并分析原因。
5. **动态调整** ：根据分析结果，系统决定调整策略：是需要增加资源？还是调整计划？甚至是修改任务范围？调整后，继续执行和监控。
6. **结果评估** ：任务完成后，生成一份总结报告，评估目标达成情况。

**应用场景** ：

- **复杂的长期项目** ：如自动化交易策略、供应链优化、营销活动管理等。
- **资源敏感型操作** ：在需要严格控制成本和时间的任务中，确保资源投入与产出成正比。

**优点** ：

- **资源高效** ：确保智能体的所有行动都紧密围绕核心目标，避免资源浪费。
- **过程可控** ：提供了对复杂任务执行过程的实时洞察和干预能力。

**缺点** ：

- **目标冲突** ：如果设定的多个KPI之间存在冲突，可能会让智能体陷入决策困境。
- **过于僵化** ：过于严格的监控和约束可能会扼杀智能体的创造性和灵活性。

### 模式十一：异常处理与恢复（Exception Handling & Recovery） 系统的“免疫力”

**核心思想** ：这是一个“元模式”，旨在为其他所有模式提供健壮性。它通过预设的安全检查和错误捕捉机制，来处理预料之外的失败，并根据错误类型执行不同的恢复策略。这就像为智能体系统配备了一套完善的急救方案和备用计划。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Iurk1iaf4xdHts9Gl6icSbPAE53Kl30Et8wVteO1O3Qr4icQ1JjY8y0QboE8LFlrzjEMkiaVg2oUMY2BUpOicG0aEGQ/640?wx_fmt=png&from=appmsg&watermark=1&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=18)

**工作流详解** ：

1. **执行与错误捕捉** ：在执行任何关键操作（如API调用）时，都用一个“try-catch”块包裹起来。
2. **错误分类** ：一旦捕捉到错误，系统首先对其进行分类：
- **临时性错误（Temporary Error）** ：如网络超时、API速率限制。恢复策略是 **指数退避（Exponential Backoff）** ，即等待一小段时间后重试，如果再次失败则加倍等待时间，直至达到上限。
	- **永久性错误（Permanent Error）** ：如API密钥无效、请求参数错误。恢复策略是启动 **B计划（Plan B）** ，例如使用一个备用API、调用一个更简单的方法、或者直接通知人类介入。
	- **严重错误（Critical Error）** ：可能危害系统安全的错误。恢复策略是 **紧急响应** ，立即保存当前工作状态，向运维团队发出警报，并进入安全模式。
4. **恢复过程** ：执行相应的恢复策略，尝试让系统回到正常工作流程。如果所有自动恢复手段都失败，最终的 fallback 永远是 **人类介入（Human-in-the-Loop）** 。

**应用场景** ：

- **生产级系统** ：任何部署在真实环境中、需要高可靠性的智能体系统都必须具备此模式。
- **与外部系统频繁交互的应用** ：外部系统的不可靠性是常态，必须有强大的异常处理能力。

**优点** ：

- **高可靠性与鲁棒性** ：极大提升了系统在面对不确定性时的生存能力。
- **提升用户信任** ：一个能够优雅处理错误而不是频繁崩溃的系统，更能赢得用户信赖。

**缺点** ：

- **实现复杂** ：设计和实现一套全面的异常处理和恢复机制需要大量的工程投入。
- **误报风险（False Alarms）** ：过于敏感的监控可能导致频繁的误报警，产生“警报疲劳”。

### 模式十二：人类介入（Human-in-the-Loop, HITL） 智慧的最后防线

**核心思想** ：在关键决策点、处理高风险任务或遇到智能体无法解决的“边缘案例”时，主动暂停自动化流程，将控制权交给人类专家进行审核、决策或直接操作。这是在追求自动化的同时，保留人类智慧和责任的必要妥协。

![图片](https://mmbiz.qpic.cn/mmbiz_png/Iurk1iaf4xdHts9Gl6icSbPAE53Kl30Et8Smzfffj7D52U3xT90jXS2PhOEa1LWiaeP0nmSb5emANhN01rMfHXknw/640?wx_fmt=png&from=appmsg&watermark=1&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=19)

**工作流详解** ：

1. **触发介入** ：当智能体遇到以下情况时，会触发HITL流程：
- 决策置信度低于阈值。
	- 任务涉及高风险操作（如大额转账、删除关键数据）。
	- 遇到法律或合规性问题。
	- 多次自动重试后依然失败。
3. **生成审核队列** ：需要人工干预的任务被放入一个 **审核队列（Review Queue）** ，并根据紧急性进行排序。
4. **呈现上下文** ：系统以清晰的UI向人类审核员展示完整的上下文信息、智能体建议的方案以及潜在的风险。
5. **人类决策** ：审核员可以做出多种决策： **批准（Approve）** 、 **拒绝（Deny）** 、编辑（Edit） **后批准，或者** 完全接管（Take Over）手动完成任务。
6. **流程继续** ：人类决策后，系统根据指令继续执行或终止流程。

**应用场景** ：

- **医疗诊断** ：AI提供初步诊断建议，但最终确诊必须由医生审核。
- **内容审核** ：AI自动过滤大部分违规内容，但对于模糊和有争议的案例，交由人工审核团队裁决。
- **金融风控** ：AI识别出可疑交易，由风控专家最终决定是否冻结账户。

**优点** ：

- **安全性与责任** ：为高风险决策提供了最终的安全保障，明确了责任主体。
- **处理复杂性** ：利用人类的常识和领域知识来解决AI难以处理的模糊和创新性问题。

**缺点** ：

- **增加延迟** ：引入人工环节会显著降低系统的处理速度，形成瓶颈。
- **成本高** ：人力成本远高于计算成本。

### 模式十三：检索增强生成（Retrieval-Augmented Generation, RAG） 知识的外挂大脑

**核心思想** ：这是目前广为人知但至关重要的模式。通过将外部知识库（如公司文档、产品手册）进行 **解析、分块、向量化** 并存储，当用户提问时，系统首先从知识库中检索最相关的信息片段，然后将其与原始问题一同注入到提示中，让LLM基于这些“接地气”的知识来生成答案，从而极大减少幻觉，并能回答其训练数据之外的问题。

**工作流详解** ：

1. **数据摄入与处理（离线）** ：
- **解析与分块（Parse & Chunk）** ：将文档解析成文本，并按照固定大小、语义边界等策略切分成小块（chunks）。
	- **嵌入与索引（Embed & Index）** ：使用嵌入模型将每个文本块转换成向量，并存入向量数据库。
3. **查询与生成（在线）** ：
- **查询重写** ：优化用户的原始查询，使其更适合向量检索。
	- **检索（Retrieve）** ：将查询向量化，在向量数据库中进行相似度搜索，找出Top-K个最相关的文本块。
	- **重排序（Rerank）** ：使用更精细的模型对检索到的文本块进行重新排序，提高最相关内容的位置。
	- **增强生成（Augmented Generation）** ：将排序后的文本块作为上下文，与用户问题一起构建提示，交给LLM生成最终答案，并可选择性地提供 **引用来源（Citations）** 。

关于RAG，感兴趣您可以看下

[![图片](https://mmbiz.qpic.cn/mmbiz_jpg/Iurk1iaf4xdEJiaBibh7yhpB0rVaicfFmdDLDXwdiaicavnICoWBeu1m7USoEkB7qemhpYe41ibVyIWjrGrDMy7adnjtg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=20)](https://mp.weixin.qq.com/s?__biz=Mzg4MzYxODkzMg==&mid=2247499428&idx=1&sn=1c2ebe6d467b9bfd5facd13cd704c492&scene=21#wechat_redirect)

[RAG太折磨人啦，试一下pip install rankify，检索、重排序、RAG三合一，完美。| 独家](https://mp.weixin.qq.com/s?__biz=Mzg4MzYxODkzMg==&mid=2247499428&idx=1&sn=1c2ebe6d467b9bfd5facd13cd704c492&scene=21#wechat_redirect)

**应用场景** ：

- **企业知识库问答** ：构建一个能回答关于公司内部政策、流程和产品的智能问答系统。
- **客户支持** ：让客服机器人能够基于最新的产品文档和帮助中心文章来回答用户问题。
- **研究辅助** ：快速在海量学术文献中查找和总结相关信息。

**优点** ：

- **高准确性** ：答案基于可信的外部知识源，显著减少了“一本正经地胡说八道”。
- **知识可更新** ：无需重新训练模型，只需更新向量数据库中的文档即可更新知识。

**缺点** ：

- **维护成本** ：需要构建和维护一套复杂的数据处理和检索管道。
- **检索质量决定上限** ：如果检索阶段找不到相关信息（所谓“大海捞针”），生成阶段的LLM也无能为力。

### 模式十四：智能体间通信（Inter-Agent Communication） 构建智能体的社会网络

**核心思想** ：为多个智能体建立一套结构化的 **消息传递系统和通信协议** ，使它们能够相互协调、分派任务、交换信息。这就像为智能体们设计一个带有已读回执、安全许可和垃圾邮件过滤器的企业级邮件系统，以防止混乱的“全体回复”灾难。

![图片](https://mp.weixin.qq.com/s/www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg%20stroke='none'%20stroke-width='1'%20fill='none'%20fill-rule='evenodd'%20fill-opacity='0'%3E%3Cg%20transform='translate(-249.000000,%20-126.000000)'%20fill='%23FFFFFF'%3E%3Crect%20x='249'%20y='126'%20width='1'%20height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

**工作流详解** ：

1. **定义通信架构** ：首先确定智能体之间的组织形式：
- **中心化（Hierarchical）** ：有一个“老板”智能体，所有通信都由它分发和管理，结构清晰，易于控制。
	- **去中心化（Democratic）** ：所有智能体地位平等，可以自由通信，灵活性高，但难以协调，容易陷入混乱。
	- **广播/公告板（Broadcast）** ：智能体通过向一个公共空间发布和订阅消息来进行通信，实现松耦合。
3. **设计消息协议** ：定义消息的格式，通常包含：
- **消息ID** ：用于跟踪和追溯。
	- **发送者/接收者身份** ：进行权限验证。
	- **过期时间** ：防止过时信息干扰系统。
	- **内容载荷**
5. **通信规则与冲突解决** ：设定智能体何时可以发言、如何提出异议、以及当它们意见不合时如何解决冲突（例如，通过投票或提交给一个“仲裁者”智能体）。
6. **异常处理** ：设计机制来处理通信中的问题，如消息丢失、智能体“卡住”或陷入无限循环对话。当自动解决失败时， **人类介入** 是最终手段。

**应用场景** ：

- **高度复杂的企业级自动化** ：模拟一个公司的跨部门协作流程。
- **智能城市系统** ：交通、能源、安防等不同领域的智能体系统需要相互通信，协同运作。
- **学术原型研究** ：探索复杂系统和社会行为的涌现。

**优点** ：

- **故障隔离（Fault Isolation）** ：结构化的通信使得追踪问题源头变得可能，可以精确地定位到是哪个智能体或哪条消息出了问题。

**缺点** ：

- **极度复杂** ：这是所有模式中最复杂、最难在生产环境中稳定实现的模式之一。调试和维护成本极高。
- **上下文过载** ：智能体间的持续对话会迅速撑爆上下文窗口。
- **涌现行为不可控** ：多个智能体自由交互可能产生无法预测的、有时甚至是有害的系统行为。

## 优化模式：追求卓越的精益之道

仅仅“能够完成”任务是不够的，真正的专家追求的是“以最佳方式完成”。优化模式聚焦于效率与效益，探讨如何让智能体系统在资源有限的约束下，做出最明智的选择。这就像一位经验丰富的管理者，不仅要确保项目交付，更要关心成本控制、资源分配和团队的持续成长。这些模式赋予智能体“成本意识”，教会它如何对任务进行优先级排序，并建立起一个能从经验中学习、不断自我迭代的进化闭环。首先，我们将探讨智能体如何像一位精明的成本管家一样工作。

### 模式十五：资源感知优化（Resource-Aware Optimization） 智能的“成本管家”

**核心思想** ：根据任务的 **复杂度和预算** ，动态地选择最合适的计算资源。简单任务使用廉价、快速的小模型；复杂任务则调用强大但昂贵的顶级模型。这就像出行时根据距离、紧急程度和预算，选择步行、公交车还是出租车。

![图片](https://mp.weixin.qq.com/s/www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg%20stroke='none'%20stroke-width='1'%20fill='none'%20fill-rule='evenodd'%20fill-opacity='0'%3E%3Cg%20transform='translate(-249.000000,%20-126.000000)'%20fill='%23FFFFFF'%3E%3Crect%20x='249'%20y='126'%20width='1'%20height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

**工作流详解** ：

1. **任务分析与预算设定** ：接收任务后，系统首先评估其复杂性，并设定一个资源预算（如Token限制、时间限制、API费用上限）。
2. **路由器决策** ：一个“路由器智能体”将任务分类为“简单”、“中等”或“复杂”。
3. **模型路由** ：
- **简单任务** \-> 小型、高效模型（如GPT-3.5-Turbo、Haiku）。
	- **中等任务** \-> 标准模型（如GPT-4、Sonnet）。
	- **复杂任务** \-> 顶级推理模型（如GPT-4o、Opus）。
5. **资源监控** ：在任务执行过程中，系统实时监控Token消耗、响应时间和API成本。
6. **动态优化** ：如果资源消耗超出限制，系统会触发优化策略：
- **上下文裁剪** ：减少发送到模型的上下文长度。
	- **提示缓存（Prompt Caching）** ：对于重复的请求，直接返回缓存结果。
	- **降级模型** ：切换到一个更便宜的模型来完成剩余任务。

**应用场景** ：

- **高并发、成本敏感的服务** ：如面向大量免费用户的聊天机器人，需要精打细算。
- **大型企业内部平台** ：处理成千上万员工的日常请求，必须在性能和成本之间找到最佳平衡。

**优点** ：

- **显著的成本节约** ：通过智能路由，确保每一分钱都花在刀刃上，避免了“杀鸡用牛刀”。

**缺点** ：

- **增加了系统复杂性** ：需要一个可靠的复杂度评估和路由机制。
- **调优挑战** ：如何精确定义“简单”与“复杂”并设置合理的路由阈值，需要大量的实验和调优。

### 模式十六：推理技术（Reasoning Techniques） 提升思维深度

**核心思想** ：为复杂问题选择最合适的“思维模式”。这不是一个单一的流程，而是一个工具箱，包含了多种先进的推理策略，如思维链（CoT）、思维树（ToT）等。这就像解决一个棘手的谜题，你会尝试不同的解题策略，直到找到最有效的那一种。

![图片](https://mp.weixin.qq.com/s/www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg%20stroke='none'%20stroke-width='1'%20fill='none'%20fill-rule='evenodd'%20fill-opacity='0'%3E%3Cg%20transform='translate(-249.000000,%20-126.000000)'%20fill='%23FFFFFF'%3E%3Crect%20x='249'%20y='126'%20width='1'%20height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

**推理方法** ：

1. **思维链（Chain of Thought, CoT）** ：对于需要逐步逻辑推导的问题，引导模型“一步一步地思考”，将复杂的推理过程分解成一个线性的、易于理解的序列。
2. **思维树（Tree of Thought, ToT）** ：对于需要探索多种可能性或创造性解决方案的问题，模型会生成多个并行的“思想分支”，对每个分支进行探索和评估，然后剪枝（Prune）掉没有希望的分支，最终在最有前途的路径上深入。
3. **自洽性（Self-Consistency）** ：通过多次生成（采用不同的随机性），产生多个独立的解决方案，然后通过“投票”选出最一致、最可靠的答案。
4. **辩论法（Debate Method）** ：创建两个或多个智能体，一个作为“支持者”，一个作为“反对者”，让它们就一个问题进行多轮辩论。通过观点的交锋，暴露出潜在的逻辑漏洞，最终综合形成一个更全面、更严谨的结论。

**工作流详解** ： 系统首先分析问题的性质，然后选择一种或多种推理技术组合使用。例如，先用思维树探索多种方案，然后对每个最有希望的方案使用思维链进行深度推导，最后用自洽性验证最终结果的稳定性。

**应用场景** ：

- **数学与逻辑推理** ：解决复杂的数学题或逻辑谜题。
- **战略规划** ：分析一个复杂的商业问题，探索多种战略并评估其优劣。
- **法律分析与医疗诊断** ：处理信息不完整、需要综合多种证据进行判断的复杂案例。

**优点** ：

- **推理能力极强** ：能够解决标准提示方法无法解决的深度复杂问题。
- **过程透明** ：推理过程被明确地展示出来，便于理解和调试。

**缺点** ：

- **Token消耗巨大** ：这些技术会产生大量的中间思考过程，导致Token成本和延迟急剧增加。
- **过犹不及** ：存在“过度思考”的风险，可能在简单问题上浪费大量资源，或陷入无法自拔的逻辑循环。

### 模式十七：评估与监控（Evaluation & Monitoring） 生产环境的“健康监测仪”

**核心思想** ：在系统部署前后建立一套全面的质量保障体系。部署前，通过 **黄金测试集（Golden Test Sets） **和** 质量门（Quality Gates） **确保其达到上线标准；部署后，持续监控其在生产环境中的** 准确性、性能、成本和模型漂移（Drift）** 。这就像一个工厂的品控体系，在产品出厂前和销售后都进行严格的质量跟踪。

![图片](https://mp.weixin.qq.com/s/www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg%20stroke='none'%20stroke-width='1'%20fill='none'%20fill-rule='evenodd'%20fill-opacity='0'%3E%3Cg%20transform='translate(-249.000000,%20-126.000000)'%20fill='%23FFFFFF'%3E%3Crect%20x='249'%20y='126'%20width='1'%20height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

**工作流详解** ：

1. **部署前评估** ：
- **创建测试套件** ：准备包含单元测试、集成测试、关键路径测试的综合测试集。
	- **定义质量标准** ：设定明确的性能指标（如响应时间）、准确率、合规性要求等。
3. **部署后持续监控** ：
- **收集指标** ：实时收集线上服务的各项性能数据。
	- **漂移检测** ：定期用同一组输入测试模型，如果输出质量随时间推移而下降，则表明发生了“模型漂移”。
	- **异常检测** ：寻找偏离正常行为模式的异常点。
5. **警报与审计** ：当监控指标超过预设阈值时，自动向开发团队发送警报。同时，定期进行人工审计，确保评估体系本身是有效的。

**应用场景** ：

- **所有生产级AI应用** ，尤其是在金融、医疗、电商等对稳定性和可靠性要求极高的行业。

**优点** ：

- **保障服务质量** ：确保AI系统在长期运行中保持高质量和高可靠性。

**缺点** ：

- **基础设施成本** ：建立和维护这样一套全面的监控和评估系统，本身就是一项重大的工程投入。
- **性能影响** ：过度的监控本身也可能对系统性能产生轻微影响。

### 模式十八：护栏与安全（Guardrails & Safety） 系统的“道德与法律顾问”

**核心思想** ：在系统的输入和输出两端设立多道“安检门”，主动检测和过滤有害内容、个人敏感信息（PII）和恶意攻击（如提示注入）。这是确保AI系统行为负责、合规和安全的核心屏障，就像机场的多重安检程序。

![图片](https://mp.weixin.qq.com/s/www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg%20stroke='none'%20stroke-width='1'%20fill='none'%20fill-rule='evenodd'%20fill-opacity='0'%3E%3Cg%20transform='translate(-249.000000,%20-126.000000)'%20fill='%23FFFFFF'%3E%3Crect%20x='249'%20y='126'%20width='1'%20height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

**工作流详解** ：

1. **输入审查** ：
- **PII检测与脱敏** ：识别并屏蔽或替换掉输入中的身份证号、电话号码等个人信息。
	- **注入攻击检测** ：识别并阻止试图操控系统行为的恶意提示。
	- **有害内容过滤** ：拦截涉及暴力、仇恨等不当内容的输入。
3. **风险分类** ：根据输入内容的风险等级（低、中、高），采取不同的处理策略。高风险输入可能会被直接拒绝或强制转入“人类介入”流程。
4. **沙盒执行（Sandboxing）** ：对于有潜在风险的操作，在一个隔离的、权限受限的“沙盒”环境中执行，防止其对主系统造成破坏。
5. **输出审查** ：在向用户返回响应之前，再次检查输出内容是否符合道德准则、法律法规和品牌安全要求。

**应用场景** ：

- **面向公众的聊天机器人** ：防止被用于生成不当言论或泄露隐私。
- **企业内部应用** ：防止员工无意或恶意地输入敏感数据，造成数据泄露。

**优点** ：

- **风险缓解** ：有效降低了AI系统被滥用或造成负面社会影响的风险。
- **合规保障** ：是满足GDPR等数据保护法规的必要技术手段。

**缺点** ：

- **误伤（False Positives）** ：过于严格的护栏可能会误拦正常的用户请求，影响用户体验。
- **增加延迟** ：多层审查会增加系统的响应时间。

### 模式十九：优先级排序（Prioritization） 智能的“急诊室分诊”

**核心思想** ：当面临多个待办任务时，系统能够根据 **价值、风险、所需精力、紧急程度** 等多个维度对任务进行综合评分，并动态调整任务队列的顺序。这就像一个急诊室的分诊系统，优先处理最危重的病人，但同时确保每个病人最终都能得到诊治。

![图片](https://mp.weixin.qq.com/s/www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg%20stroke='none'%20stroke-width='1'%20fill='none'%20fill-rule='evenodd'%20fill-opacity='0'%3E%3Cg%20transform='translate(-249.000000,%20-126.000000)'%20fill='%23FFFFFF'%3E%3Crect%20x='249'%20y='126'%20width='1'%20height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

**工作流详解** ：

1. **构建依赖图** ：首先分析任务之间的依赖关系，明确哪些任务是其他任务的前置条件。
2. **任务评分** ：为每个任务计算一个 **优先级分数** 。一个常用的公式是： `优先级 = (业务价值 × 紧急程度) / (所需精力 × 风险)` 。
3. **动态调度** ：
- 系统总是从队列顶部（优先级最高）开始执行任务。
	- **关键在于** ：每完成一个任务后，系统会 **重新评估** 整个任务队列的优先级。因为完成一个任务可能会改变其他任务的紧急程度或依赖关系（例如，你在上班路上遇到堵车，那么“回家吃饭”的优先级就可能被“直接去公司”所取代）。
5. **处理新事件** ：当有新的高优先级任务（“插队”任务）出现时，系统可以暂停当前任务，先处理紧急任务。

**应用场景** ：

- **动态任务管理系统** ：如智能工单系统、DevOps自动化流水线。
- **客户服务** ：优先处理来自VIP客户或涉及严重问题的请求。

**优点** ：

- **高适应性** ：能够灵活应对动态变化的环境，始终将资源投入到最重要的事情上。
- **透明度** ：优先级计算规则明确，使得任务调度过程可解释。

**缺点** ：

- **上下文切换开销** ：频繁地重新评估和切换任务会带来额外的计算开销。
- **饥饿问题** ：低优先级的任务可能长时间得不到执行。

## 战略模式：赋予智能体方向与远见

在所有战术和执行之上，是战略。战略模式将我们的视角提升到最高层次，关注的不再是“如何做”，而是“做什么”以及“为何而做”。这些模式赋予智能体一种目的感和方向感。它们让系统能够理解并始终对齐一个宏大的目标，监控自己是否偏离了航道，甚至在未知的水域中，主动探索和发现新的知识大陆。这是通往真正自主智能的最后一步，让智能体从一个被动的任务执行者，转变为一个具有远见和主动性的战略伙伴。我们将从为智能体设定清晰的北极星指标开始。

### 模式二十与二十一：探索与发现（Exploration & Discovery） 智能的“科研先锋”

**核心思想** ：模拟科学研究的过程，从一个宽泛的研究目标出发，广泛地探索相关知识空间（论文、数据集、专家观点等），识别出模式和主题，然后聚焦于最有希望的领域进行深度挖掘。这就像一名侦探，先广泛收集所有线索，然后将它们聚类分析，最后锁定几个最有嫌疑的对象进行重点突破。

![图片](https://mp.weixin.qq.com/s/www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg%20stroke='none'%20stroke-width='1'%20fill='none'%20fill-rule='evenodd'%20fill-opacity='0'%3E%3Cg%20transform='translate(-249.000000,%20-126.000000)'%20fill='%23FFFFFF'%3E%3Crect%20x='249'%20y='126'%20width='1'%20height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

**工作流详解** ：

1. **广泛探索** ：根据研究目标，智能体从多个来源搜集大量原始信息。
2. **知识空间映射** ：对收集到的信息进行处理，识别出关键概念和它们之间的关系，构建一个“知识地图”。
3. **主题聚类** ：将相似的信息点聚合在一起，形成几个核心主题。
4. **确定焦点** ：根据 **新颖性、潜在影响、知识空白** 等标准，从这些主题中选择一到两个最有价值的方向进行深入研究。
5. **深度调查** ：在选定的方向上进行详尽的信息提取和分析。
6. **综合与报告** ：将深度调查的结果综合起来，提取关键洞见，提出开放性问题，甚至生成新的假说，最终形成一份详尽的研究报告。

**应用场景** ：

- **学术研究** ：自动化文献综述、发现新的研究方向。
- **市场与竞品分析** ：全面了解市场格局，发现新的商业机会。
- **药物发现** ：在海量生物医学数据中筛选有潜力的化合物和靶点。

**优点** ：

- **创新驱动** ：能够帮助人类研究者发现被忽略的联系和机会，激发创新。

**缺点** ：

- **资源密集型** ：需要大量的计算资源来处理和分析海量信息。
- **结果不确定性** ：探索性任务的本质决定了其产出是不确定的，可能耗费大量资源后一无所获。

## 写在最后

回到本文开头的命题：高级智能体的难点，不在“能不能做出来”，而在“做得稳、管得住、可度量”。这本近500多的Agentic设计手册之所以有价值，正在于它把零散技巧沉淀为可复用的 **工程设计模式** ，为从Demo走向生产提供了可复制的骨架。PDF的版本我分享到我的Agent开发交流群里和同步到IMA知识库（AI修猫Prompt-上下文工程），欢迎您来一起交流！

未来已来，有缘一起同行！

![Image](https://mp.weixin.qq.com/s/www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg%20stroke='none'%20stroke-width='1'%20fill='none'%20fill-rule='evenodd'%20fill-opacity='0'%3E%3Cg%20transform='translate(-249.000000,%20-126.000000)'%20fill='%23FFFFFF'%3E%3Crect%20x='249'%20y='126'%20width='1'%20height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)

<本文完 结>

1. **转载请与本喵联系，私自抓取转载将被起诉**

🎉 **让我们一起创造更多美好！** 🎉

  

如果您觉得这篇文章对您有帮助

感谢您为我 **【点赞】** 、 **【在看】**

  

**<您为我点赞在看，只有我能看到>**

  

**👉** **微信号：xiumaoprompt**

**添加请注明来意！**

感谢！

素材来源官方媒体/网络新闻

继续滑动看下一个

AI修猫Prompt

向上滑动看下一个